<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <!--代表禁止浏览器从本地计算机的缓存中访问页面内容-->
  <!--<meta http-equiv="pragram" content="no-cache">
  &lt;!&ndash;请求和响应不缓存&ndash;&gt;
  <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">-->
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <!--IE / Edge 自动给数字加下划线的问题-->
  <meta name="format-detection" content="telephone=no,email=no,address=no">
  <title>3D地图测试</title>

  <link rel="stylesheet" type="text/css" href="../../static/css/public.css" />
  <link rel="stylesheet" type="text/css" href="../../static/map3d/css/widgets.css" />
  <script>
    document.write('<script src="../../static/config/config.js?v=' + new Date().getTime() + '"><\/script>');
  </script>

  <script src="../../static/map3d/libs/Cesium.js"></script>
  <script src="../../static/map3d/utils/GIS/GisData.js"></script>
  <script src="../../static/map3d/utils/GIS/light3D.js"></script>
  <script src="../../static/map3d/utils/GIS/initLight3D.js"></script>
  <script src="../../static/map3d/utils/GIS3D.js"></script>
</head>
<body>
    <div id="cesiumContainer"></div>
    <script>
      gis3d = new GIS3D();
      gis3d.initload("cesiumContainer", false);
      gis3d.updateCameraPosition(121.17659986110053,31.28070920407326,39.142101722743725,5.573718449729121,-0.23338301782710902,6.281191529370343);


      //初始化地图--道路数据
      GisData.initRoadDate(gis3d.cesium.viewer);
      //初始化地图服务--上帝视角时使用
      GisData.initServer(gis3d.cesium.viewer);
      //初始化模型数据--树
      GisData.initThreeData(gis3d.cesium.viewer);
    
      addEventListener('message', e => {
        // e.data为父页面发送的数据
        let eventData = e.data
          if(eventData.type == "updateCam"){
            gis3d.updateCameraPosition(eventData.data.x,eventData.data.y,eventData.data.z,eventData.data.radius,eventData.data.pitch,eventData.data.yaw);
          }

          if(eventData.type == "getCamData"){
            let camData = gis3d.getCamera();


            parent.postMessage(camData,"*");
          }
          
          if(eventData.type == "addModel"){    
            gis3d.addModeCar({
              longitude:eventData.data.longitude,
              latitude:eventData.data.latitude,
              heading:eventData.data.heading,
              vehicleId:eventData.data.vehicleId,
            },
            eventData.data.name,
            eventData.data.glbName,
            );
          }
      })



    

    </script>
</body>
</html>